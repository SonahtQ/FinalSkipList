(()=>{"use strict";var e={660:function(e,o,t){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});const r=n(t(664));window.FinalSkipList=r.default},664:function(e,o,t){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});const r=n(t(430)),a=n(t(158)),s=n(t(15));var i;!function(e){e[e.ZERO=0]="ZERO",e[e.SINGLE=1]="SINGLE",e[e.RANGE=2]="RANGE"}(i||(i={}));class l{static from(e,o){return new l(e,o)}#e;#o;#t;#n;#r;constructor(...e){let o,t;if(0==e.length)o=[],t=void 0;else if(1==e.length)e[0][Symbol.iterator]?(o=e[0],t=void 0):(o=[],t=e[0]);else{if(2!=e.length)throw new Error("Wrong argument list");o=e[0],t=e[1]}this.#e=Object.assign({maxLevel:32,getLevel:null},t??{}),this.#o=new a.default(Number.NEGATIVE_INFINITY,null,this.#e.maxLevel),this.#t=new a.default(Number.POSITIVE_INFINITY,null,this.#e.maxLevel),this.#n=new r.default,this.#r=0;for(let e=0;e<this.#e.maxLevel;e++)this.#o.next[e]=this.#t,this.#t.prev[e]=this.#o,this.#o.forwardSpan[e]=1,this.#t.backwardSpan[e]=1;for(const e of o)this.insert(e[0],e[1])}#a(e){return this.size-1-e}#s(){if(this.#e.getLevel)return Math.max(1,Math.min(this.#e.maxLevel,this.#e.getLevel(this.#e)));let e=1;for(;Math.random()<.5&&e<this.#e.maxLevel;)e++;return e}#i(e){const o="number"!=typeof e[0]?i.ZERO:"number"!=typeof e[1]?i.SINGLE:i.RANGE;let t,n,r;switch(o){case i.ZERO:t=n=-1,r=e;break;case i.SINGLE:t=e[0],n=t,r=e.slice(1);break;case i.RANGE:t=e[0],n=e[1],r=e.slice(2)}return[o,r,t,n]}#l(e){const o=this.#i(e);return o[2]<0&&(o[2]=Math.max(-1,this.size+o[2])),o[3]<0&&(o[3]=Math.max(-1,this.size+o[3])),o}#f(e,o){const t=new Array(this.#e.maxLevel).fill(null),n=new Array(this.#e.maxLevel).fill(-1);if(o){const o=new s.default(this.#t,-1);for(let r=this.#e.maxLevel-1;r>=0;r--){for(;o.ft_hasFollowing(r)&&o.ft_peekFollowingScore(r)>e;)o.ft_move(r);n[r]=this.#a(o.ft_peekFollowingRank(r)),t[r]=o.ft_peekFollowingNode(r)}}else{const o=new s.default(this.#o,-1);for(let r=this.#e.maxLevel-1;r>=0;r--){for(;o.fh_hasFollowing(r)&&o.fh_peekFollowingScore(r)<=e;)o.fh_move(r);n[r]=o.rank,t[r]=o.node}}return[t,n]}#h(e,o){if(o){const o=this.#a(e),t=new Array(this.#e.maxLevel).fill(null),n=new s.default(this.#t,-1);for(let e=this.#e.maxLevel-1;e>=0;e--){for(;n.ft_hasFollowing(e)&&n.ft_peekFollowingRank(e)<=o;)n.ft_move(e);t[e]=n.ft_peekFollowingNode(e)}return n.ft_move(0),n.rank=this.#a(n.rank),[n,t]}{const o=new Array(this.#e.maxLevel).fill(null),t=new s.default(this.#o,-1);for(let n=this.#e.maxLevel-1;n>=0;n--){for(;t.fh_hasFollowing(n)&&t.fh_peekFollowingRank(n)<e;)t.fh_move(n);o[n]=t.node}return[t,o]}}#d(e,o){if(o){const o=new Array(this.#e.maxLevel).fill(null),t=new s.default(this.#t,-1);for(let n=this.#e.maxLevel-1;n>=0;n--){for(;t.ft_hasFollowing(n)&&t.ft_peekFollowingScore(n)>=e;)t.ft_move(n);o[n]=t.ft_peekFollowingNode(n)}return t.ft_move(0),t.rank=this.#a(t.rank),[t,o]}{const o=new Array(this.#e.maxLevel).fill(null),t=new s.default(this.#o,-1);for(let n=this.#e.maxLevel-1;n>=0;n--){for(;t.fh_hasFollowing(n)&&t.fh_peekFollowingScore(n)<e;)t.fh_move(n);o[n]=t.node}return[t,o]}}#c(e,o){if(o){const o=this.#a(e),t=new s.default(this.#t,-1);for(let e=this.#e.maxLevel-1;e>=0;e--)for(;t.ft_hasFollowing(e)&&t.ft_peekFollowingRank(e)<=o;)t.ft_move(e);return t.node.isTail?null:t.node}{const o=new s.default(this.#o,-1);for(let t=this.#e.maxLevel-1;t>=0;t--)for(;o.fh_hasFollowing(t)&&o.fh_peekFollowingRank(t)<=e;)o.fh_move(t);return o.node.isHead?null:o.node}}#u(e,o){let t;if(o){t=new s.default(this.#t,-1);for(let o=this.#e.maxLevel-1;o>=0;o--)for(;t.ft_hasFollowing(o)&&t.ft_peekFollowingScore(o)>=e.score;)t.ft_move(o);t.ft_move(0),t.rank=this.#a(t.rank)}else{t=new s.default(this.#o,-1);for(let o=this.#e.maxLevel-1;o>=0;o--)for(;t.fh_hasFollowing(o)&&t.fh_peekFollowingScore(o)<e.score;)t.fh_move(o)}for(;t.fh_hasFollowing(0)&&t.fh_peekFollowingScore(0)==e.score;)if(t.fh_move(0),t.node==e)return t.rank;throw new Error("Provided node doesn't exist in skiplist at the moment.")}get size(){return this.#r}insert(e,o,t=!1){if(o==Number.NEGATIVE_INFINITY||o==Number.POSITIVE_INFINITY)throw new Error("Provide real number score, infinity values are forbidden.");const n=this.#s(),r=new a.default(o,e,n),[s,i]=this.#f(o,t);for(let e=0;e<this.#e.maxLevel;e++){const o=s[e],t=s[e].next[e];if(e<n){r.prev[e]=o,r.next[e]=t,o.next[e]=r,t.prev[e]=r;const n=this.#a(i[0]+s[0].forwardSpan[0]),a=this.#a(i[e]+o.forwardSpan[e]),l=i[0]-i[e],f=n-a;r.forwardSpan[e]=o.forwardSpan[e]-l,o.forwardSpan[e]=l+1,r.backwardSpan[e]=t.backwardSpan[e]-f,t.backwardSpan[e]=f+1}else o.forwardSpan[e]++,t.backwardSpan[e]++}this.#n.registerToNodeSet(r),this.#r++}deleteByScore(...e){const[o,t,n,r]=this.#i(e),[a,s]=t;if(n>r)return[];const i=[],[l,f]=this.#d(n,s);for(;l.fh_hasFollowing(0)&&l.fh_peekFollowingScore(0)<=r;){l.fh_move(0);for(let e=0;e<this.#e.maxLevel;e++){const o=f[e];if(o.next[e]==l.node){const t=l.fh_peekFollowingNode(e);o.next[e]=t,t.prev[e]=o,o.forwardSpan[e]+=l.node.forwardSpan[e]-1,t.backwardSpan[e]+=l.node.backwardSpan[e]-1}else{const t=o.next[e];o.forwardSpan[e]--,t.backwardSpan[e]--}}a?i.push({value:l.node.value,score:l.node.score,rank:l.rank}):i.push(l.node.value)}return this.#r-=i.length,i}deleteByRank(...e){const[o,t,n,r]=this.#l(e),[a,s]=t;if(n>=this.#r||r>=this.#r||-1==n&&-1==r||n>r)return o==i.SINGLE?null:[];let[l,f]=this.#h(n,s);const h=[];for(;l.fh_hasFollowing(0)&&l.fh_peekFollowingRank(0)<=r;){l.fh_move(0);for(let e=0;e<this.#e.maxLevel;e++){const o=f[e];if(o.next[e]==l.node){const t=l.fh_peekFollowingNode(e);o.next[e]=t,t.prev[e]=o,o.forwardSpan[e]+=l.node.forwardSpan[e]-1,t.backwardSpan[e]+=l.node.backwardSpan[e]-1}else{const t=o.next[e];o.forwardSpan[e]--,t.backwardSpan[e]--}}a?h.push({value:l.node.value,score:l.node.score,rank:l.rank}):h.push(l.node.value)}return this.#r-=h.length,o==i.SINGLE?h[0]??null:h}deleteByValue(e,o,t){const n=this.#n.getNodeSet(e);if(!n)return[];const r=o?Array.from(n).map((e=>this.#u(e,t))):void 0;return this.#r-=n.size,r?Array.from(n).map(((e,o)=>(this.#p(e),{value:e.value,score:e.score,rank:r[o]}))):Array.from(n).map((e=>(this.#p(e),e.score)))}#p(e){let o;for(o=0;o<this.#e.maxLevel;o++){const t=e.prev[o],n=e.next[o];if(!t||!n||t.next[o]!=e||n.prev[o]!=e)break;t.next[o]=n,n.prev[o]=t,t.forwardSpan[o]+=e.forwardSpan[o]-1,n.backwardSpan[o]+=e.backwardSpan[o]-1}if(o--,o<this.#e.maxLevel-1){let t=e,n=e;for(let e=o;e<this.#e.maxLevel&&(e>o&&(t.forwardSpan[e]--,n.backwardSpan[e]--),!(e>=this.#e.maxLevel-1));e++){for(;t!=this.#o&&!t.prev[e+1];)t=t.prev[e];for(;n!=this.#t&&!n.next[e+1];)n=n.next[e]}}this.#n.unregisterFromNodeSet(e)}popFirst(e){const o=this.#o.next[0];return o==this.#t?null:(this.#p(o),this.#r--,e?{value:o.value,score:o.score,rank:0}:o.value)}popLast(e){const o=this.#t.prev[0];return o==this.#o?null:(this.#p(o),this.#r--,e?{value:o.value,score:o.score,rank:this.#r}:o.value)}getByScore(...e){const[o,t,n,r]=this.#i(e),[a,s]=t;if(n>r)return[];const i=[],[l]=this.#d(n,s);for(;l.fh_hasFollowing(0)&&l.fh_peekFollowingScore(0)<=r;)l.fh_move(0),a?i.push({value:l.node.value,score:l.node.score,rank:l.rank}):i.push(l.node.value);return i}getByRank(...e){const[o,t,n,r]=this.#l(e),[a,l]=t;if(-1==n&&-1==r||n>r)return o==i.SINGLE?null:[];let f=this.#c(n,l);if(o==i.SINGLE)return f?a?{value:f.value,score:f.score,rank:n}:f.value:null;if(!f)return[];const h=new s.default(f,n),d=[];for(;h.node&&!h.node.isTail&&h.rank<=r;)a?d.push({value:h.node.value,score:h.node.score,rank:h.rank}):d.push(h.node.value),h.fh_move(0);return d}getScore(e){return Array.from(this.#n.getNodeSet(e)??[]).map((e=>e.score))}getRank(e,...o){let t=this.#n.getNodeSet(e);const[n,r,a,s]=this.#i(o),[l,f]=r;if(l){const e=[];return t?.forEach((o=>{(n==i.ZERO||o.score>=a&&o.score<=s)&&e.push({value:o.value,score:o.score,rank:this.#u(o,f)})})),e}{const e=[];return t?.forEach((o=>{(n==i.ZERO||o.score>=a&&o.score<=s)&&e.push(this.#u(o,f))})),e}}countByValue(e){return this.#n.get(e)?.size??0}countByScore(...e){const[o,t,n,r]=this.#i(e),[a]=t;if(n>r)return 0;const[s]=this.#d(n,a);if(s.fh_move(0),s.node.isTail||!(s.node.score>=n&&s.node.score<=r))return 0;const i=s.rank;for(let e=s.node.level-1;e>=0;e-=1)for(;s.fh_hasFollowing(e)&&s.fh_peekFollowingScore(e)<=r;)s.fh_move(e);return s.rank-i+1}has(e){this.#n.has(e)}forEach(e){for(const o of this)e(...o)}forEachBackward(e){for(const o of this.backward())e(...o)}toString(){return JSON.stringify(Array.from(this))}*#v(){const e=new s.default(this.#o,-1);for(;e.fh_hasFollowing(0);)e.fh_move(0),yield e.node}*[Symbol.iterator](){const e=new s.default(this.#o,-1);for(;e.fh_hasFollowing(0);)e.fh_move(0),yield[e.node.value,e.node.score,e.rank]}*backward(){const e=new s.default(this.#t,-1);for(;e.ft_hasFollowing(0);)e.ft_move(0),yield[e.node.value,e.node.score,this.#a(e.rank)]}debugVisualization(){if(this.size>9)throw new Error("ASCII visualization in console works only for maximum 9 of nodes.");const e=11,o=new Map;let t=0;const n=[];let r=this.#o;for(;r;){r==this.#o?o.set(r,"H"):r==this.#t?o.set(r,"T"):o.set(r,o.get(r)??t++);const e=r==this.#o||r==this.#t;n.push({isCurrentNodeBorder:e,id:o.get(r),value:r.value,score:r.score,fspan:r.forwardSpan,bspan:r.backwardSpan,next:r.next,prev:r.prev}),r=r.next[0]}console.log("Size is "+this.size+", content: "+this),console.log(n.map((o=>(o.isCurrentNodeBorder?"$":"*").repeat(e))).join(" ")),console.log(n.map((e=>`|id: ${e.id}`.padEnd(10," ")+"|")).join(" ")),console.log(n.map((o=>"-".repeat(e))).join(" "));for(let e=this.#e.maxLevel-1;e>=0;e--)console.log(n.map((t=>{let n="";return n+=`|${e}| `,(o.has(t.prev[e])||o.has(t.next[e]))&&(n+=o.has(t.prev[e])?o.get(t.prev[e])+"<":" <",n+="-",n+=o.has(t.next[e])?">"+o.get(t.next[e]):"> "),n.padEnd(10," ")+"|"})).join(" "));console.log(n.map((o=>"-".repeat(e))).join(" "));for(let e=this.#e.maxLevel-1;e>=0;e--)console.log(n.map((o=>(`|${e}| `+(o.fspan[e]?`~~> ${o.fspan[e]}`:"")).padEnd(10," ")+"|")).join(" "));console.log(n.map((o=>"-".repeat(e))).join(" "));for(let e=this.#e.maxLevel-1;e>=0;e--)console.log(n.map((o=>(`|${e}| `+(o.bspan[e]?`${o.bspan[e]} <~~`:"")).padEnd(10," ")+"|")).join(" "));console.log(n.map((o=>"-".repeat(e))).join(" ")),console.log(n.map((e=>"|"+(e.isCurrentNodeBorder?"":`$: ${e.value}`).padEnd(9," ")+"|")).join(" ")),console.log(n.map((e=>"|"+(e.isCurrentNodeBorder?"":`#: ${e.score}`).padEnd(9," ")+"|")).join(" ")),console.log(n.map((o=>(o.isCurrentNodeBorder?"$":"*").repeat(e))).join(" "))}}o.default=l},430:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0});class t extends Map{registerToNodeSet(e){const o=this.get(e.value)??new Set;0==o.size&&this.set(e.value,o),o.add(e)}unregisterFromNodeSet(e){const o=this.get(e.value);o.delete(e),0==o.size&&this.delete(e.value)}getNodeSet(e){return this.get(e)}}o.default=t},158:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=class{score;value;next;prev;forwardSpan;backwardSpan;constructor(e,o,t){this.score=e,this.value=o,this.next=new Array(t).fill(null),this.prev=new Array(t).fill(null),this.forwardSpan=new Array(t).fill(0),this.backwardSpan=new Array(t).fill(0)}get level(){return this.next.length}get isBorder(){return this.isHead||this.isTail}get isHead(){return null==this.prev[0]}get isTail(){return null==this.next[0]}}},15:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default=class{node;rank;constructor(e,o){this.node=e,this.rank=o}fh_move(e){this.rank+=this.node.forwardSpan[e],this.node=this.node.next[e]}ft_move(e){this.rank+=this.node.backwardSpan[e],this.node=this.node.prev[e]}fh_hasFollowing(e){return this.node.next[e]&&!this.node.next[e].isTail}ft_hasFollowing(e){return this.node.prev[e]&&!this.node.prev[e].isHead}fh_peekFollowingNode(e){return this.node.next[e]}ft_peekFollowingNode(e){return this.node.prev[e]}fh_peekFollowingRank(e){return this.rank+this.node.forwardSpan[e]}ft_peekFollowingRank(e){return this.rank+this.node.backwardSpan[e]}fh_peekFollowingScore(e){return this.node.next[e].score}ft_peekFollowingScore(e){return this.node.prev[e].score}}}},o={};!function t(n){var r=o[n];if(void 0!==r)return r.exports;var a=o[n]={exports:{}};return e[n].call(a.exports,a,a.exports,t),a.exports}(660)})();